{"version":3,"sources":["generate.js","App.js","index.js"],"names":["start","window","tf","tfc","progress","bytesUsed","MODEL_URL","location","href","get_models","model_name","model_type","a","progressesList","num_called","mirrorPad","node","performance","now","length","memoryInfo","numBytes","inputs","arraySync","generate","model","long_side_scale_size","img","output","console","log","img_tensor","fromPixels","shape","scale_factor","scaled_size","Math","round","scaled_img_tensor","resizeBilinear","expandDims","div","dispose","executeAsync","generated","end","toPixels","squeeze","add","generateImage","resize","fp16","img_id","canvas_id","set","model_load_start","then","model_load_end","document","getElementById","App","props","onUpload","e","input","target","reader","FileReader","onload","dataURL","result","setState","uploadedImageURL","uploaded","readAsDataURL","files","download","canvas","url","toDataURL","link","createElement","click","state","generationStatus","alert","updateGenerationProgressInterval","setInterval","generationProgress","clearInterval","success","componentWillUnmount","updateGenerationgresProsInterval","className","Container","fluid","style","this","Row","Col","xs","textAlign","md","lg","Form","File","accept","label","onChange","multiple","custom","xl","margin","id","alt","src","Group","controlId","Control","as","value","defaultValue","parseInt","Button","variant","onClick","ProgressBar","reload","React","Component","ReactDOM","render","StrictMode","preHeat"],"mappings":"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","file":"static/js/main.e000df8c.chunk.js","sourcesContent":["import * as tf from '@tensorflow/tfjs';\nimport * as tfc from '@tensorflow/tfjs-converter';\n\nwindow.tf = tf;\nwindow.tfc = tfc;\nwindow.progress = 0;\nwindow.bytesUsed = 0;\n\ntf.enableProdMode();\n\nlet start;\n\n// const MODEL_URL = window.location.href + 'models/float16/summerwar/model.json';\n// const MODEL_URL = window.location.href + 'models/float32/hayao/model.json';\nlet MODEL_URL = window.location.href + 'models/hayao/uint8/model.json';\n\n\n// console.log(`model_name:${model_name}`)\n\nlet get_models = async (model_name, model_type) => {\n    if (model_name === \"hayao\") {\n        MODEL_URL = window.location.href + `models/hayao/${model_type}/model.json`;\n        // MODEL_URL = window.location.href + 'hayo_models/float32/model.json';\n    } else if (model_name === \"paprika\") {\n        MODEL_URL = window.location.href + `models/paprika/${model_type}/model.json`;\n    } else if (model_name === \"shinkai\") {\n        MODEL_URL = window.location.href + `models/shinkai/${model_type}/model.json`;\n    } else if (model_name === \"strange_daddy\") {\n        MODEL_URL = window.location.href + `models/strange_daddy/${model_type}/model.json`;\n    } else if (model_name === \"charge\") {\n        MODEL_URL = window.location.href + `models/charge/${model_type}/model.json`;\n    } else if (model_name === \"iblard\") {\n        MODEL_URL = window.location.href + `models/iblard/${model_type}/model.json`;\n    }\n}\n\n\nconst progressesList = [0.00023367749587460492, 0.054088046653978504, 0.1804816724673639, 0.18052037621199904, 0.2528568019649621, 0.37458444400475477, 0.39315031021211105, 0.39319017797911254, 0.4444196766347441, 0.5207431700988491, 0.550593651422125, 0.5542242372745627, 0.5605664132978859, 0.5806242652109398, 0.5927784050567816, 0.5962346785553008, 0.5981026434950807, 0.5989430676647844, 0.6435568450337933, 0.6676838282371483, 0.6684442258671517, 0.7463103400111626, 0.9019785470675509, 0.95];\nlet num_called = 0;\n\nconst mirrorPad = async (node) => {\n    let progress = 0.9 * (performance.now() - start) / (15463.61999999499);\n\n    /* progressesList.push(progress);\n    console.log(progressesList); */\n\n    if (num_called >= progressesList.length) {\n        progress = 0.95;\n    } else {\n        progress = progressesList[num_called];\n    }\n    num_called += 1;\n\n    window.progress = progress;\n\n    let memoryInfo = tf.memory();\n    // console.log(\"Memory Info:\", memoryInfo);\n    window.bytesUsed = memoryInfo.numBytes;\n\n    // Use normal pad (not mirror pad):\n    return tf.mirrorPad(node.inputs[0], node.inputs[1].arraySync(), 'reflect');\n\n};\n\ntfc.registerOp('MirrorPad', mirrorPad);\n\nconst generate = async (model, long_side_scale_size, img, output) => {\n    console.log(\"Generation start\")\n    let img_tensor = tf.browser.fromPixels(img);\n    let scaled_img_tensor;\n    console.log(\"Original image size:\", img_tensor.shape);\n    if (long_side_scale_size !== -1) {\n        let scale_factor = (img_tensor.shape[0] > img_tensor.shape[1] ? img_tensor.shape[0] : img_tensor.shape[1]) / long_side_scale_size; // long side scaled size\n        let scaled_size = [Math.round(img_tensor.shape[0] / scale_factor), Math.round(img_tensor.shape[1] / scale_factor)];\n        console.log(\"Scale to:\", scaled_size);\n        scaled_img_tensor = tf.tidy(() => (\n            tf.image.resizeBilinear(img_tensor, scaled_size).expandDims(0).div(255)\n        )); // Batch size may be larger\n        img_tensor.dispose();\n    } else {\n        scaled_img_tensor = tf.tidy(() => (\n            img_tensor.expandDims(0).div(255)\n        )); // Batch size may be larger\n        img_tensor.dispose();\n    }\n\n    start = performance.now();\n    let generated = await model.executeAsync({ 'generator_input': scaled_img_tensor });\n    // let generated = await model.executeAsync({ 'test': scaled_img_tensor });\n\n    scaled_img_tensor.dispose();\n    let end = performance.now();\n    console.log(\"Image Generated\");\n    console.log(`Took ${(end - start) / 1000} s to generate the image`);\n\n    tf.browser.toPixels((generated.squeeze(0).add(1)).div(2), output);\n    // console.log(generated.print());\n    generated.dispose();\n}\n\nlet preHeat = () => {\n    // Pre-heat\n    let model_load_start = performance.now();\n    tfc.loadGraphModel(MODEL_URL).then((model) => {\n        console.log(`Model Loaded: ${MODEL_URL}`);\n        let model_load_end = performance.now();\n        console.log(`Took ${(model_load_end - model_load_start) / 1000} s to load the model`);\n        model.dispose();\n    });\n}\n\nlet generateImage = async (model_name, model_type, resize, fp16, img_id, canvas_id) => {\n    if (fp16) {\n        // tf.webgl.forceHalfFloat();\n        tf.env().set('WEBGL_FORCE_F16_TEXTURES', true);\n    } else {\n        tf.env().set('WEBGL_FORCE_F16_TEXTURES', false);\n    }\n\n    get_models(model_name, model_type);\n\n    console.log(`MODEL URL is:${MODEL_URL}`);\n    console.log(`model_name is:${model_name}`);\n    console.log(`model_type is:${model_type}`);\n\n    let long_side_scale_size;\n\n    if (resize === \"s\") {\n        long_side_scale_size = 100;\n    } else if (resize === \"m\") {\n        long_side_scale_size = 250;\n    } else if (resize === \"l\") {\n        long_side_scale_size = 500;\n    } else if (resize === \"ll\") {\n        long_side_scale_size = 750;\n    } else if (resize === \"L\") {\n        long_side_scale_size = 1000;\n    } else {\n        long_side_scale_size = -1;\n    }\n\n    let model_load_start = performance.now();\n\n\n\n    await tfc.loadGraphModel(MODEL_URL).then(async (model) => {\n        console.log(`Model Loaded:${MODEL_URL}`);\n        let model_load_end = performance.now();\n        console.log(`Took ${(model_load_end - model_load_start) / 1000} s to load the model`);\n        console.log(model);\n        await generate(model, long_side_scale_size, document.getElementById(img_id), document.getElementById(canvas_id));\n        tf.disposeVariables();\n        console.log(tf.memory());\n    });\n    window.progress = 1.0;\n};\n\nexport { preHeat, generateImage };\n","import React from 'react';\nimport { Button, Form, Container, Row, Col, ProgressBar } from 'react-bootstrap';\nimport { generateImage } from './generate.js';\n\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport './App.css';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      uploadedImageURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=\",\n      uploaded: false,\n      model_name: \"hayao\",\n      model_type: \"float32\",\n      fp16: 0,\n      resize: \"l\",\n      generationStatus: 0,\n      updateGenerationgresProsInterval: -1,\n      bytesUsed: 0\n    };\n  }\n\n  onUpload = (e) => {\n    var input = e.target;\n    var reader = new FileReader();\n    reader.onload = () => {\n      var dataURL = reader.result;\n      this.setState({\n        uploadedImageURL: dataURL,\n        uploaded: true\n      });\n    };\n    reader.readAsDataURL(input.files[0]);\n  }\n\n  download = (e) => {\n    var canvas = document.getElementById(\"output\");\n    var url = canvas.toDataURL(\"image/png\");\n    var link = document.createElement('a');\n    link.download = 'output.png';\n    link.href = url;\n    link.click();\n    console.log(canvas);\n  }\n\n\n  generate = async () => {\n    if (this.state.generationStatus !== 0) {\n      return;\n    }\n\n    console.log(this.state);\n    if (this.state.uploaded === false) {\n      alert(\"Please upload an image.\");\n      return;\n    }\n    if (this.state.resize === \"none\") {\n      alert(\"Please select a resize method.\");\n      return;\n    }\n\n    window.progress = 0;\n    window.bytesUsed = 0;\n    let updateGenerationProgressInterval = setInterval(() => {\n      this.setState({\n        generationProgress: window.progress * 100,\n        bytesUsed: window.bytesUsed\n      });\n\n      if (this.state.generationStatus !== 1) {\n        clearInterval(updateGenerationProgressInterval);\n      }\n    }, 500);\n\n\n    this.setState({\n      generationStatus: 1,\n      updateGenerationProgressInterval: updateGenerationProgressInterval\n    });\n    let success = false;\n    try {\n      await generateImage(this.state.model_name, this.state.model_type, this.state.resize, this.state.fp16, \"uploaded-image\", \"output\");\n      success = true;\n    } catch (error) {\n      alert(\"Error encountered while generating image: \" + error);\n      this.setState({\n        generationStatus: 0\n      });\n    }\n\n    if (success) {\n      this.setState({\n        generationStatus: 2\n      });\n    }\n\n  }\n\n\n\n\n  componentWillUnmount = () => {\n    if (this.state.updateGenerationProgressInterval !== -1) {\n      clearInterval(this.state.updateGenerationProgressInterval);\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"app\">\n        <Container fluid style={{ \"display\": this.state.generationStatus === 0 ? \"block\" : \"none\" }}>\n          <Row className=\"margin\">\n            <Col />\n            <Col xs=\"12\">\n              <h1 style={{ \"marginBottom\": \"20px\", textAlign: \"center\" }}>AnimeGAN-js beta: 0.0.5v </h1>\n            </Col>\n            <Col />\n          </Row>\n          <Row className=\"margin\">\n            <Col />\n            <Col xs=\"12\" md=\"8\" lg=\"6\">\n              <Form>\n                <Form.File accept=\"image/*\" label={(this.state.uploaded ? \"Change the image\" : \"이미지 업로드\")} onChange={this.onUpload} multiple={false} custom />\n              </Form>\n\n            </Col>\n            <Col />\n          </Row>\n          <Row className=\"margin\">\n            <Col />\n            <Col xs=\"12\" md=\"8\" lg=\"5\" xl=\"4\" style={{ textAlign: \"center\", margin: \"20px\" }}>\n              <img id=\"uploaded-image\" alt=\"\" src={this.state.uploadedImageURL} />\n            </Col>\n            <Col />\n          </Row>\n          <Row className=\"margin\">\n            <Col />\n            <Col xs=\"12\" md=\"8\" lg=\"6\" style={{ textAlign: \"center\" }}>\n              <Form>\n\n                <Form.Group controlId=\"model_name\">\n                  <Form.Control as=\"select\" onChange={(e) => this.setState({ model_name: e.target.value })}>\n                    <option value=\"hayao\">미야자키 하야오</option>\n                    <option value=\"paprika\">파프리카</option>\n                    <option value=\"shinkai\">신카이</option>\n                    <option value=\"strange_daddy\">이상한 아빠의 식성</option>\n                    <option value=\"charge\">차지</option>\n                    <option value=\"iblard\">이발라드</option>\n\n                  </Form.Control>\n                </Form.Group>\n\n\n                <Form.Group controlId=\"resize\">\n                  <Form.Control defaultValue=\"l\" as=\"select\" onChange={(e) => this.setState({ resize: e.target.value })}>\n                    <option value=\"l\">고화질</option>\n                    <option value=\"ll\">고화질+ (메모리 overflow 주의!)</option>\n                    <option value=\"L\">고화질++ (메모리 overflow 주의!)</option>\n\n                    {/* <option value=\"none\" disabled>Select Generated Image Size</option> */}\n                    <option value=\"m\">저화질</option>\n                    <option value=\"original\">원본(추천안함)</option>\n                  </Form.Control>\n                </Form.Group>\n\n                <Form.Group controlId=\"model_type\">\n                  <Form.Control as=\"select\" onChange={(e) => this.setState({ model_type: e.target.value })}>\n                    <option value=\"float32\">float32</option>\n                    <option value=\"uint8\">uint8</option>\n                    <option value=\"float16\">float16</option>\n                  </Form.Control>\n                </Form.Group>\n\n                <Form.Group controlId=\"fp16\">\n                  <Form.Control as=\"select\" onChange={(e) => this.setState({ fp16: parseInt(e.target.value) })}>\n                    <option value=\"0\">WEB_GL FP16: False</option>\n                    <option value=\"1\">WEB_GL FP16: True</option>\n                  </Form.Control>\n                </Form.Group>\n\n\n                <Button variant=\"primary\" onClick={this.generate}>이미지 생성</Button>\n              </Form>\n            </Col>\n            <Col />\n          </Row>\n        </Container>\n\n        <div className=\"overlay\" style={{ \"display\": this.state.generationStatus === 1 ? \"block\" : \"none\" }}>\n\n          <div style={{ \"marginTop\": \"calc( 50vh - 50px )\", \"height\": \"100px\", \"textAlign\": \"center\" }}>\n            <Container fluid>\n              <Row>\n                <Col />\n                <Col xs=\"12\" md=\"8\" lg=\"6\" style={{ textAlign: \"center\" }}>\n                  <ProgressBar now={this.state.generationProgress} style={{ \"margin\": \"10px\" }} />\n                  <p>이미지 생성 중 ...</p>\n                  <p>메모리 사용량 (MB): {this.state.bytesUsed / 1024 ** 2} </p>\n                </Col>\n                <Col />\n              </Row>\n            </Container>\n          </div>\n\n        </div>\n\n        <div className=\"overlay\" style={{ \"display\": this.state.generationStatus === 2 ? \"block\" : \"none\" }}>\n          <Container fluid>\n            <Row className=\"margin\">\n              <Col />\n              <Col xs=\"12\" md=\"8\" lg=\"5\" xl=\"4\" style={{ textAlign: \"center\", margin: \"20px\" }}>\n                <canvas id=\"output\"></canvas>\n              </Col>\n              <Col />\n            </Row>\n            <Row className=\"margin\">\n              <Col />\n              <Col xs=\"12\" md=\"12\" lg=\"12\" xl=\"10\" style={{ textAlign: \"center\", margin: \"20px\" }}>\n                <p>Source codes were from following:</p>\n                <p>Frontend: <a href=\"https://github.com/TonyLianLong/AnimeGAN.js\">https://github.com/TonyLianLong/AnimeGAN.js</a></p>\n                <p>Backend:  <a href=\"https://github.com/TachibanaYoshino/AnimeGAN\">https://github.com/TachibanaYoshino/AnimeGAN</a></p>\n                <Button variant=\"primary\" onClick={this.download}>이미지 다운로드</Button>\n                <Button variant=\"primary\" onClick={() => window.location.reload()}>다른 이미지 만들기</Button>\n              </Col>\n              <Col />\n            </Row>\n          </Container>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nimport { preHeat } from './generate.js';\n\nReactDOM.render(\n    <React.StrictMode>\n        <App />\n    </React.StrictMode>,\n    document.getElementById('root')\n);\n\npreHeat();\n"],"sourceRoot":""}